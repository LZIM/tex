---
title: Talk of Talks
author: Talky Talker
date: Day of the Talk
---

```{r setup, include=F, cache=F}
library(knitr)
# attempt to set a reasonable code output textwidth
options(width=44)
opts_knit$set(width=44)
opts_chunk$set(
    comment=NA, # no comment chars decorating code output
    collapse=T, # multiple statements and output collapsed together
    dev="tikz", # TikZ graphs: nice but slow
    fig.width=4.5, fig.height=2.75,   # beamer cards are 128 mm x 96 mm
    size ='footnotesize',             # gets zoomed up to something reasonable
    dev.args=list(pointsize=9),
    message=F, warning=F,             # quit your chatter, R
    error=T,    # stop on error: can get annoying
    echo=F,     # hide chunk code by default
    cache=T,
    autodep=T)

# code output environment hook
knit_hooks$set(output=function (x, options) {
    paste(c("\\begin{ROutput}",
            sub("\n$", "", x),
            "\\end{ROutput}",
            ""),
          collapse="\n")
})

# Plot placement and resizing hook
#
# Allows you to use the textpos grid for placing and sizing plots on
# slides. Example usage below.
#
# This gives us some new options and changes the meaning of two others:
#
# out.width, out.height: reinterpreted as units on the textpos grid.
# N.B. this sets the scaling by pdflatex of an image file whose
# generated dimensions are set by fig.width and fig.height (always
# inches).
#
# textblock_width: width of the block in textpos grid units
#
# textblock_pos: 2-element vector of grid coordinates of the textblock
#
# center: Boolean: enclose graphic within center environment?
#
# inside_textblock: don't generate textblock environment, just the
# \includegraphics line (useful if, e.g., you write out the environment
# \begin and \end yourself and stick the code chunk between them)
#
# Grid positioning only happens if inside_textblock=T or textblock_width
# is specified. Otherwise we revert to knitr's normal behavior. Grid
# positioning also always makes graphics inline. Use inside_textblock=T
# and enclose it in a figure environment yourself if you want to combine
# the textblock and the figure environment (you probably don't).
#
# The main use for this is probably to place a single figure on the grid
# instead of in the normal flow of elements.
#
# N.B. the default knitr plot output hook for LaTeX responds to many
# more options than this does. But in my workflow we are knitting to
# markdown, not LaTeX. That's a simplifying decision in some ways but
# with some costs in flexibility.

plot_hook_default <- knit_hooks$get("plot")
knit_hooks$set(plot=function (x, options) {
    inside <- options$inside_textblock
    pos <- options$textblock_pos
    b <- ""
    e <- ""
    if (is.null(inside)) {
        inside <- F
    }
    if (is.numeric(options$textblock_width) || inside) {
        if(!inside && is.numeric(pos) && length(pos) == 2) {
            b <- paste0(
                "\\begin{textblock}{", options$textblock_width, "}(",
                pos[1], ",", pos[2], ")\n"
            )
            e <- "\\end{textblock}\n"
        }

        if (!is.null(options$center) && options$center) {
            b <- paste0(b, "\\begin{center}\n")
            e <- paste0("\n\\end{center}", e)
        }

        if (is.null(options$out.width) && is.null(options$out.height)) {
            opt <- ""
        } else if (is.null(options$out.width)) {
            opt <- paste0("[height=", options$out.height, "\\TPVertModule]")
        } else if (is.null(options$out.height)) {
            opt <- paste0("[width=", options$out.width, "\\TPHorizModule]")
        } else {
            opt <- paste0("[width=", options$out.width, "\\TPHorizModule],",
                          "[height=", options$out.height, "\\TPVertModule]")
        }

        # filename munging here taken from knitr:::hook_plot_md_base
        # just in case this will help with rmarkdown's file management
        base_url <-opts_knit$get("base.url")
        if (is.null(base_url)) {
            base_url <- ""
        }
        gfx <- paste0("\\includegraphics", opt, "{", base_url, x, "}\n")
        paste0(b, gfx, e)
    }
    else {
        plot_hook_default(x, options)
    }
})

# tikzDevice setup: install the tikzDevice package
options(tikzDefaultEngine="xetex")

# tikzDevice + xelatex
options(tikzXelatexPackages=c(
    "\\usepackage{tikz}\n",
    "\\usepackage[active,tightpage,xetex]{preview}\n",
    "\\usepackage{fontspec,xunicode}\n",
    "\\setmainfont{Gill Sans}\n",
    "\\PreviewEnvironment{pgfpicture}\n",
    "\\setlength\\PreviewBorder{0pt}\n"))

# load your favorite libraries
library(ggplot2)
library(xtable)

# import code from this file as chunks, to be included just below
read_chunk("slide-utils.R")
```

```{r dark-plot-theme, include=F}
```

```{r print-tabular, include=F}
```

# an example text slide


> - with an incremental
> - build

\note{<1>}{

And different notes on the first

}

\note{<2>}{

and second increments.

}

# an example table

```{r results="asis"}
print_tabular(mtcars[1:5, 1:5],
              floating=T,
              caption="Something about cars")
```

# an example graphic

```{r graph, fig.cap="I think that I shall never see"}
ggplot(trees, aes(Girth, Height)) +
    geom_point(color="white") +
    plot_theme()
```

# ugly examples of custom placement and sizing

```{r displaced, textblock_width=2.75, textblock_pos=c(0, 1), fig.height=3, fig.width=2, out.height=4, center=T}
p <- ggplot(mtcars, aes(factor(cyl))) +
    geom_bar(color="white", fill="grey60") +
    xlab("Another car thing") +
    plot_theme()
p
```

\begin{textblock}{2.75}(3,2)

Look! a dodgy three-column layout!

With great layout power comes great, etc., etc.
\end{textblock}

\begin{textblock}{2.75}(6,1)
```{r displaced-over, inside_textblock=T, center=T}
p
```

Text scaling: \\
a cautionary tale.
\end{textblock}

# example code display

```{r code, echo=T}
cor(anscombe$x1, anscombe$y1)
cor(anscombe$x2, anscombe$y2)
```

Definitely don't need to visualize.
